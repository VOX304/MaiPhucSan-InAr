# SmartHoover Bonus API

# HOST: https://api.smarthoover.example.com/v1

openapi: 3.0.3
info:
  title: SmartHoover Bonus API (Assignment 3)
  version: "2.0.0"
  description: |
    REST API for administering SmartHoover salesmen and their social performance
    records, backed by MongoDB and integrated enterprise systems (OrangeHRM and OpenCRX).
servers:
  - url: https://api.smarthoover.example.com/v1
    description: Production server (example for ApiLint / HTTPS rule)
  - url: http://localhost:3000/api/v1
    description: Local development server

tags:
  - name: Salesmen
    description: CRUD operations for salesmen
  - name: Performance
    description: Social performance records
  - name: Integration
    description: Read-only access to OrangeHRM and OpenCRX
paths:
  /salesmen:
    get:
      tags: [Salesmen]
      summary: List salesmen
      parameters:
        - in: query
          name: q
          schema: { type: string }
          description: Filter by partial name or email
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/Salesman" }
    post:
      tags: [Salesmen]
      summary: Create salesman
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewSalesman" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
  /salesmen/{id}:
    get:
      tags: [Salesmen]
      summary: Get salesman by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
    put:
      tags: [Salesmen]
      summary: Update salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateSalesman" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
    delete:
      tags: [Salesmen]
      summary: Delete salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
  /performance:
    get:
      tags: [Performance]
      summary: List social performance records
      parameters:
        - in: query
          name: salesmanId
          schema: { type: string }
        - in: query
          name: year
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/PerformanceRecord" }
    post:
      tags: [Performance]
      summary: Create performance record (one per salesman+year)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewPerformanceRecord" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
  /performance/{id}:
    put:
      tags: [Performance]
      summary: Update performance record by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdatePerformanceRecord" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
    delete:
      tags: [Performance]
      summary: Delete performance record by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
  /salesmen/{id}/performance:
    get:
      tags: [Performance]
      summary: List performance records for a given salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: year
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/PerformanceRecord" }
    /external/orangehrm/salesmen:
    get:
      tags: [Integration]
      summary: List salesmen from OrangeHRM
      description: >
        Returns salesmen data fetched from the OrangeHRM tenant and mapped into
        the internal Salesman representation. Read-only.
      responses:
        "200":
          description: List of mapped OrangeHRM employees
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Salesman"

  /external/opencrx/accounts:
    get:
      tags: [Integration]
      summary: List accounts from OpenCRX
      description: >
        Returns a subset of account data from the OpenCRX instance. Read-only.
      responses:
        "200":
          description: List of OpenCRX accounts
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/OpenCrxAccount"

components:
  schemas:
    Salesman:
      type: object
      required: [id, firstName, lastName]
      properties:
        id: { type: string, example: "90123" }
        firstName: { type: string, example: "John" }
        middleName: { type: string, nullable: true }
        lastName: { type: string, example: "Smith" }
        email: { type: string, format: email, nullable: true }
        hireDate: { type: string, format: date, nullable: true }
        department: { type: string, example: "Sales" }
        supervisor: { type: string, nullable: true }
    NewSalesman:
      type: object
      required: [firstName, lastName]
      properties:
        id: { type: string, description: "Optional custom id" }
        firstName: { type: string }
        middleName: { type: string }
        lastName: { type: string }
        email: { type: string, format: email }
        hireDate: { type: string, format: date }
        department: { type: string }
        supervisor: { type: string }
    UpdateSalesman:
      allOf:
        - $ref: '#/components/schemas/NewSalesman'
    GoalScore:
      type: object
      required: [goalId, description, valueSupervisor, valuePeerGroup]
      properties:
        goalId: { type: string, example: "leadership" }
        description: { type: string, example: "Leadership competence" }
        valueSupervisor: { type: integer, minimum: 1, maximum: 5, example: 4 }
        valuePeerGroup: { type: integer, minimum: 1, maximum: 5, example: 4 }
    PerformanceRecord:
      type: object
      required: [id, salesmanId, year, goals]
      properties:
        id: { type: string, example: "sp-90123-2025" }
        salesmanId: { type: string, example: "90123" }
        year: { type: integer, example: 2025 }
        goals:
          type: array
          items: { $ref: "#/components/schemas/GoalScore" }
        remarks: { type: string, nullable: true }
    NewPerformanceRecord:
      type: object
      required: [salesmanId, year, goals]
      properties:
        salesmanId: { type: string }
        year: { type: integer }
        goals:
          type: array
          items: { $ref: "#/components/schemas/GoalScore" }
        remarks: { type: string }
    UpdatePerformanceRecord:
      allOf:
        - $ref: '#/components/schemas/NewPerformanceRecord'
    EnvelopeSalesman:
      type: object
      properties:
        data: { $ref: "#/components/schemas/Salesman" }
    EnvelopePerformance:
      type: object
      properties:
        data: { $ref: "#/components/schemas/PerformanceRecord" }
        OpenCrxAccount:
      type: object
      description: Minimal projection of an OpenCRX account used by the dashboard
      required: [id, fullName]
      properties:
        id:
          type: string
          example: "account-123"
        fullName:
          type: string
          example: "Acme Corp."
        email:
          type: string
          format: email
          nullable: true
          example: "contact@acme.com"
        accountNo:
          type: string
          nullable: true
          description: "Optional OpenCRX account number"
          example: "ACME-001"

