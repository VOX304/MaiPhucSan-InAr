<mat-card style="margin-bottom: 16px">
  <h3>HR Assistant Cockpit</h3>

  <p>
    This view supports:
    <strong>MVP_FR1</strong> (salesmen), <strong>MVP_FR2</strong> (social records),
    <strong>N_FR5</strong> (edit target/actual), <strong>N_FR3</strong> (charts),
    and optionally <strong>N_FR6</strong> (Odoo employees).
  </p>

  <div *ngIf="error" style="margin: 10px 0; color: #b00020">
    {{ error }}
  </div>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Selection</h4>

  <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center">
    <mat-form-field appearance="fill" style="min-width: 240px">
      <mat-label>Salesman</mat-label>
      <mat-select [value]="selectedEmployeeId" (selectionChange)="setSelection($event.value)">
        <mat-option *ngFor="let s of salesmen" [value]="s.employeeId">
          {{ s.employeeId }} — {{ s.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 140px">
      <mat-label>Year</mat-label>
      <input matInput type="number" [(ngModel)]="year" />
    </mat-form-field>

    <button mat-stroked-button (click)="loadSocial()">Reload Social</button>
    <button mat-stroked-button (click)="loadOrders(false)">Reload Orders</button>
    <button mat-stroked-button color="primary" (click)="loadOrders(true)">Refresh Orders from OpenCRX</button>
    <button mat-stroked-button (click)="syncSalesman()">Sync Salesman from OrangeHRM</button>
  </div>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Salesmen (MVP_FR1)</h4>

  <table class="mat-elevation-z1" style="width: 100%; border-collapse: collapse">
    <thead>
      <tr>
        <th style="text-align: left; padding: 6px">EmployeeId</th>
        <th style="text-align: left; padding: 6px">Name</th>
        <th style="text-align: left; padding: 6px">Department</th>
        <th style="text-align: left; padding: 6px">Year</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of salesmen">
        <td style="padding: 6px">{{ s.employeeId }}</td>
        <td style="padding: 6px">{{ s.name }}</td>
        <td style="padding: 6px">{{ s.department }}</td>
        <td style="padding: 6px">{{ s.performanceYear }}</td>
      </tr>
    </tbody>
  </table>

  <h5 style="margin-top: 16px">Create Salesman</h5>
  <form [formGroup]="salesmanForm" (ngSubmit)="createSalesman()" style="display: flex; gap: 12px; flex-wrap: wrap">
    <mat-form-field appearance="fill">
      <mat-label>EmployeeId</mat-label>
      <input matInput formControlName="employeeId" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Department</mat-label>
      <input matInput formControlName="department" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>Year</mat-label>
      <input matInput type="number" formControlName="performanceYear" />
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit">Create</button>
  </form>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Social Performance (MVP_FR2 / N_FR5)</h4>
  <p><strong>Social total:</strong> {{ socialTotalEur | number : '1.2-2' }} EUR</p>

  <table class="mat-elevation-z1" style="width: 100%; border-collapse: collapse">
    <thead>
      <tr>
        <th style="text-align: left; padding: 6px">RecordId</th>
        <th style="text-align: left; padding: 6px">Criterion</th>
        <th style="text-align: left; padding: 6px">Target</th>
        <th style="text-align: left; padding: 6px">Actual</th>
        <th style="text-align: left; padding: 6px">Weight</th>
        <th style="text-align: left; padding: 6px">Bonus</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let r of socialRecords">
        <td style="padding: 6px; font-family: monospace">{{ r._id }}</td>
        <td style="padding: 6px">{{ r.criterionName }}</td>
        <td style="padding: 6px">{{ r.targetValue }}</td>
        <td style="padding: 6px">{{ r.actualValue }}</td>
        <td style="padding: 6px">{{ r.weight }}</td>
        <td style="padding: 6px">{{ r.computedBonusEur | number : '1.2-2' }}</td>
      </tr>
    </tbody>
  </table>

  <h5 style="margin-top: 16px">Create Social Record</h5>
  <form [formGroup]="socialCreateForm" (ngSubmit)="createSocialRecord()" style="display: flex; gap: 12px; flex-wrap: wrap">
    <mat-form-field appearance="fill">
      <mat-label>criterionKey</mat-label>
      <input matInput formControlName="criterionKey" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>criterionName</mat-label>
      <input matInput formControlName="criterionName" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Target</mat-label>
      <input matInput type="number" formControlName="targetValue" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Actual</mat-label>
      <input matInput type="number" formControlName="actualValue" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Weight</mat-label>
      <input matInput type="number" formControlName="weight" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>Supervisor</mat-label>
      <input matInput type="number" formControlName="supervisorRating" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>Peer</mat-label>
      <input matInput type="number" formControlName="peerRating" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="min-width: 240px">
      <mat-label>Remark</mat-label>
      <input matInput formControlName="remark" />
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit">Create</button>
  </form>

  <h5 style="margin-top: 16px">Edit Social Record (PATCH) (N_FR5)</h5>
  <p>
    Copy a <code>RecordId</code> from the table and set new target/actual values.
  </p>

  <form [formGroup]="socialPatchForm" (ngSubmit)="patchSocialRecord()" style="display: flex; gap: 12px; flex-wrap: wrap">
    <mat-form-field appearance="fill" style="min-width: 280px">
      <mat-label>recordId</mat-label>
      <input matInput formControlName="recordId" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Target</mat-label>
      <input matInput type="number" formControlName="targetValue" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Actual</mat-label>
      <input matInput type="number" formControlName="actualValue" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 100px">
      <mat-label>Weight</mat-label>
      <input matInput type="number" formControlName="weight" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>Supervisor</mat-label>
      <input matInput type="number" formControlName="supervisorRating" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>Peer</mat-label>
      <input matInput type="number" formControlName="peerRating" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="min-width: 240px">
      <mat-label>Remark</mat-label>
      <input matInput formControlName="remark" />
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit">Update</button>
  </form>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Orders Evaluation (COULD)</h4>
  <p><strong>Orders total:</strong> {{ ordersTotalEur | number : '1.2-2' }} EUR</p>

  <table class="mat-elevation-z1" style="width: 100%; border-collapse: collapse">
    <thead>
      <tr>
        <th style="text-align: left; padding: 6px">OrderId</th>
        <th style="text-align: left; padding: 6px">Product</th>
        <th style="text-align: left; padding: 6px">Client</th>
        <th style="text-align: left; padding: 6px">Prob</th>
        <th style="text-align: left; padding: 6px">Ranking</th>
        <th style="text-align: left; padding: 6px">Items</th>
        <th style="text-align: left; padding: 6px">Revenue</th>
        <th style="text-align: left; padding: 6px">Bonus</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let o of orders">
        <td style="padding: 6px">{{ o.orderId }}</td>
        <td style="padding: 6px">{{ o.productName }}</td>
        <td style="padding: 6px">{{ o.clientName }}</td>
        <td style="padding: 6px">{{ o.closingProbability }}</td>
        <td style="padding: 6px">{{ o.clientRanking }}</td>
        <td style="padding: 6px">{{ o.itemsCount }}</td>
        <td style="padding: 6px">{{ o.revenueEur }}</td>
        <td style="padding: 6px">{{ o.computedBonusEur | number : '1.2-2' }}</td>
      </tr>
    </tbody>
  </table>

  <h5 style="margin-top: 16px">Create Order Record (manual demo)</h5>
  <form [formGroup]="orderCreateForm" (ngSubmit)="createOrder()" style="display: flex; gap: 12px; flex-wrap: wrap">
    <mat-form-field appearance="fill">
      <mat-label>orderId</mat-label>
      <input matInput formControlName="orderId" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>productName</mat-label>
      <input matInput formControlName="productName" />
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>clientName</mat-label>
      <input matInput formControlName="clientName" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>ranking</mat-label>
      <input matInput type="number" formControlName="clientRanking" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 140px">
      <mat-label>probability</mat-label>
      <input matInput type="number" formControlName="closingProbability" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 120px">
      <mat-label>items</mat-label>
      <input matInput type="number" formControlName="itemsCount" />
    </mat-form-field>

    <mat-form-field appearance="fill" style="width: 140px">
      <mat-label>revenue EUR</mat-label>
      <input matInput type="number" formControlName="revenueEur" />
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit">Create</button>
  </form>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Bonus Chart (N_FR3)</h4>
  <p>
    Shows total bonus per salesman for the selected year. (Data is available after CEO computed and HR stored bonus.)
  </p>
  <canvas #bonusChart></canvas>
  <div style="margin-top: 10px">
    <button mat-stroked-button (click)="loadBonusStatistics()">Reload Chart</button>
  </div>
</mat-card>

<mat-card style="margin-bottom: 16px">
  <h4>Odoo employees (N_FR6)</h4>
  <p>Only works if Odoo credentials are configured in backend <code>.env</code>.</p>
  <button mat-stroked-button (click)="loadOdooEmployees()">Fetch from Odoo</button>

  <ul>
    <li *ngFor="let e of odooEmployees">
      {{ e.name }} — {{ e.email }} — {{ e.company }}
    </li>
  </ul>
</mat-card>

<mat-card>
  <h4>Dependencies Health</h4>
  <div *ngIf="dependencies; else noDeps">
    <ul>
      <li>MongoDB: {{ dependencies.mongodb.reachable }}</li>
      <li>OrangeHRM: {{ dependencies.orangehrm.reachable }}</li>
      <li>OpenCRX: {{ dependencies.opencrx.reachable }}</li>
      <li>Camunda: {{ dependencies.camunda.reachable }}</li>
    </ul>
  </div>
  <ng-template #noDeps>
    <div>Health info not available.</div>
  </ng-template>
</mat-card>
