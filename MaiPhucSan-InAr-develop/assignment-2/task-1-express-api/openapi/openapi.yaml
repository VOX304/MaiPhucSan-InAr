
openapi: 3.0.3
info:
  title: Salesmen & Social Performance API (Assignment 2.1)
  version: "1.0.0"
  description: |
    First REST API version for administering salesmen and their **social performance** records.
    Data is **hard-coded** (no database). This API is used in Task 1-b and tested in Task 1-c.
servers:
  - url: http://localhost:3000/api/v1
paths:
  /salesmen:
    get:
      summary: List salesmen
      parameters:
        - in: query
          name: q
          schema: { type: string }
          description: Filter by partial name or email
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/Salesman" }
    post:
      summary: Create salesman
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewSalesman" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
  /salesmen/{id}:
    get:
      summary: Get salesman by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
    put:
      summary: Update salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateSalesman" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
    delete:
      summary: Delete salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopeSalesman" }
        "404":
          description: Not found
  /performance:
    get:
      summary: List social performance records
      parameters:
        - in: query
          name: salesmanId
          schema: { type: string }
        - in: query
          name: year
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/PerformanceRecord" }
    post:
      summary: Create performance record (one per salesman+year)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/NewPerformanceRecord" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
  /performance/{id}:
    put:
      summary: Update performance record by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdatePerformanceRecord" }
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
    delete:
      summary: Delete performance record by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/EnvelopePerformance" }
  /salesmen/{id}/performance:
    get:
      summary: List performance records for a given salesman
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
        - in: query
          name: year
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  total: { type: integer }
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/PerformanceRecord" }
components:
  schemas:
    Salesman:
      type: object
      required: [id, firstName, lastName]
      properties:
        id: { type: string, example: "90123" }
        firstName: { type: string, example: "John" }
        middleName: { type: string, nullable: true }
        lastName: { type: string, example: "Smith" }
        email: { type: string, format: email, nullable: true }
        hireDate: { type: string, format: date, nullable: true }
        department: { type: string, example: "Sales" }
        supervisor: { type: string, nullable: true }
    NewSalesman:
      type: object
      required: [firstName, lastName]
      properties:
        id: { type: string, description: "Optional custom id" }
        firstName: { type: string }
        middleName: { type: string }
        lastName: { type: string }
        email: { type: string, format: email }
        hireDate: { type: string, format: date }
        department: { type: string }
        supervisor: { type: string }
    UpdateSalesman:
      allOf:
        - $ref: '#/components/schemas/NewSalesman'
    GoalScore:
      type: object
      required: [goalId, description, valueSupervisor, valuePeerGroup]
      properties:
        goalId: { type: string, example: "leadership" }
        description: { type: string, example: "Leadership competence" }
        valueSupervisor: { type: integer, minimum: 1, maximum: 5, example: 4 }
        valuePeerGroup: { type: integer, minimum: 1, maximum: 5, example: 4 }
    PerformanceRecord:
      type: object
      required: [id, salesmanId, year, goals]
      properties:
        id: { type: string, example: "sp-90123-2025" }
        salesmanId: { type: string, example: "90123" }
        year: { type: integer, example: 2025 }
        goals:
          type: array
          items: { $ref: "#/components/schemas/GoalScore" }
        remarks: { type: string, nullable: true }
    NewPerformanceRecord:
      type: object
      required: [salesmanId, year, goals]
      properties:
        salesmanId: { type: string }
        year: { type: integer }
        goals:
          type: array
          items: { $ref: "#/components/schemas/GoalScore" }
        remarks: { type: string }
    UpdatePerformanceRecord:
      allOf:
        - $ref: '#/components/schemas/NewPerformanceRecord'
    EnvelopeSalesman:
      type: object
      properties:
        data: { $ref: "#/components/schemas/Salesman" }
    EnvelopePerformance:
      type: object
      properties:
        data: { $ref: "#/components/schemas/PerformanceRecord" }
